<!doctype html>
<html lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Duel</title>
<style>
  html,body {
    height:100%; margin:0;
    background:#000;                /* black background */
  }
  svg { width:100vw; height:100vh; display:block; }
  .circle { fill:#fff; transition: fill 0.15s; }  /* white circle */
  .circle.flash { fill:#888 !important; }         /* grey flash */
  
  /* Congratulations message styling */
  .congrats-text {
    fill: #fff;
    font-family: "EB Garamond", serif;
    font-weight: 700;
    text-anchor: start;
    dominant-baseline: hanging;
  }
  
  /* Delayed text that appears after 2 seconds */
  .delayed-text {
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
  }
  
  .delayed-text.show {
    opacity: 1;
  }
</style>
</head>
<body>
<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
  <!-- Congratulations message in top-left corner -->
  <text x="-20" y="8" 
        font-size="6" 
        class="congrats-text">
    Well done!
  </text>
  <text x="-20" y="18" 
        font-size="6" 
        class="congrats-text">
    You've learned to input a DOT
  </text>
  
  <text x="15" y="78" 
        font-size="6" 
        class="congrats-text delayed-text"
        id="dashInstruction">
    Now try holding for a DASH
  </text>

  <!-- centered circle -->
  <circle id="dotCircle" class="circle" cx="50" cy="50" r="20"/>
</svg>

<script>
  let pressStart = null;
  let navigating = false;               // prevent double redirects
  const THRESHOLD = 250;                // < 250ms = dot
  const FLASH_MS  = 500;
  const back = () => location.href = "index.html";

  const circle = document.getElementById('dotCircle');
  
  // Show delayed text after 1 seconds
  setTimeout(() => {
    const dashInstruction = document.getElementById('dashInstruction');
    dashInstruction.classList.add('show');
  }, 1500);

  function handleSignal(duration){
    if (navigating) return;
    if (duration < THRESHOLD) {
      // DOT: flash then redirect
      navigating = true;
      circle.classList.add('flash');
      setTimeout(()=> back(), FLASH_MS);
    } else {
      // DASH: do nothing here
    }
  }

  // Keyboard (Enter)
  window.addEventListener("keydown", e => {
    if (e.code === "Enter" && pressStart === null) {
      pressStart = Date.now();
      e.preventDefault();
    }
  });
  window.addEventListener("keyup", e => {
    if (e.code === "Enter" && pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      handleSignal(duration);
      e.preventDefault();
    }
  });

  // Mouse (left click/hold)
  window.addEventListener("mousedown", e => {
    if (e.button === 0 && pressStart === null) pressStart = Date.now();
  });
  window.addEventListener("mouseup", e => {
    if (e.button === 0 && pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      handleSignal(duration);
    }
  });

  // Touch (tap/hold)
  window.addEventListener("touchstart", () => {
    if (pressStart === null) pressStart = Date.now();
  }, { passive: true });
  window.addEventListener("touchend", () => {
    if (pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      handleSignal(duration);
    }
  });
</script>
</body>
</html>